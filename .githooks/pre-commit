#!/usr/bin/env bash
set -euo pipefail

mapfile -d '' staged < <(git diff --cached --name-only -z --diff-filter=ACMR | tr '\0' '\n' | grep -E '\.nix$' || true)

if (( ${#staged[@]} > 0 )); then
  echo "Formatting staged Nix files"
  nix run nixpkgs#nixfmt -- "${staged[@]}"
  git add -- "${staged[@]}"
else
  echo "No staged Nix files to format"
fi

echo "Statix"
nix run nixpkgs#statix -- check .
